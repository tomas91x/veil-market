# Veil Market

Veil Market is a privacy-forward swap dApp built on Zama's FHEVM. It lets users swap ETH for fZama at a fixed
exchange rate (1 ETH = 800 fZama) while keeping balances encrypted on-chain. The frontend displays encrypted
balances by default and reveals the plaintext only when the user explicitly requests decryption.

## Project Goals

- Provide a simple, fixed-rate ETH â†’ fZama swap experience.
- Keep on-chain balances encrypted and only reveal plaintext on user demand.
- Demonstrate an end-to-end FHEVM workflow with clear, production-like structure.

## Key Features

- Fixed-rate swap: 1 ETH = 800 fZama.
- Encrypted balances stored on-chain; decrypt on demand in the UI.
- Clear separation of contract logic, deployment scripts, tasks, and tests.
- Frontend reads via `viem` and writes via `ethers` (explicitly enforced).

## Problems Solved

- **Privacy of balances**: balances remain encrypted on-chain, reducing exposure of user holdings.
- **Predictable pricing**: fixed rate removes slippage and pricing ambiguity.
- **User clarity**: encrypted-by-default UI makes privacy the default behavior.

## Advantages

- Strong privacy posture with FHE-based balance management.
- Simple fixed-rate model is easy to understand and test.
- Minimal, transparent architecture: contracts, tasks, tests, and frontend are clearly separated.
- No reliance on localstorage or environment variables in the frontend.

## Tech Stack

- **Smart Contracts**: Solidity + Hardhat + Zama FHEVM libraries
- **Frontend**: React + Vite + RainbowKit
- **Chain Access**: `viem` for reads, `ethers` for writes
- **Package Manager**: npm
- **No Tailwind**: styling is done without Tailwind utilities

## Repository Layout

```
contracts/   # Swap contract and related FHE logic
deploy/      # Deployment scripts for local + Sepolia
tasks/       # Hardhat tasks
test/        # Contract tests
home/        # React + Vite frontend
```

## Getting Started

### Prerequisites

- Node.js 20+
- npm

### Install Dependencies

```bash
npm install
```

### Environment Configuration (Hardhat)

Create a `.env` in the project root with the following values:

```
INFURA_API_KEY=your_infura_api_key
PRIVATE_KEY=your_deployer_private_key
```

Notes:
- The deployment uses a **private key** and **never** a mnemonic.
- The frontend does **not** read environment variables.

### Compile

```bash
npm run compile
```

### Run Tests

```bash
npm run test
```

### Local Development Node

```bash
npx hardhat node
```

### Deploy Locally

```bash
npx hardhat deploy --network localhost
```

This is for local contract development and testing. The frontend should not be configured to use localhost.

### Deploy to Sepolia

```bash
npx hardhat deploy --network sepolia
```

### Frontend (Vite)

```bash
cd home
npm install
npm run dev
```

Notes:
- The UI uses encrypted balances by default and only decrypts on user action.
- The app is expected to connect to Sepolia (no localhost network).

## ABI Source of Truth

The frontend must consume the ABI generated by the contracts and stored in `deployments/sepolia`.

## Future Roadmap

- Add multi-asset support beyond fZama with configurable fixed rates.
- Introduce rate governance and time-based rate updates.
- Add advanced privacy UX (batch decrypt, selective reveal, exportable proofs).
- Expand test coverage for edge cases (insufficient liquidity, rate boundary cases).
- Optional: integrate a public status page for deployment metadata.

## License

BSD-3-Clause-Clear (see `LICENSE`).
